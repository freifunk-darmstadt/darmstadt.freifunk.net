variables:
  LANG: "C.UTF-8"
  NOKOGIRI_USE_SYSTEM_LIBRARIES: "1"

stages:
  - build
  - test
  - publish

build:
  stage: build
  image: jekyll/jekyll:latest
  cache:
    key: $CI_COMMIT_SHA
    paths:
      - output
  script:
    - jekyll build -d output
  artifacts:
    paths:
    - output

test:
  stage: test
  image: 18fgsa/html-proofer:gitlab-ci
  allow_failure: true
  cache:
    key: $CI_COMMIT_SHA
    policy: pull
    paths:
      - output/
  script:
    - htmlproofer ./output

publish:
  image: appropriate/curl:latest
  stage: publish
  only:
    - master
  script:
    - curl $DEPLOY_URL

